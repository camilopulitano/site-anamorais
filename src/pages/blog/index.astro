---
// --- ARQUIVO: src/pages/index.astro ---
import BaseLayout from '../layouts/BaseLayout.astro';

// LISTA COMPLETA E ATUALIZADA
const obras = [
  // --- OBRAS VENDIDAS ---
  { titulo: "A Rena", dimensoes: "30 x 40 cm", tecnica: "Aquarela", preco: "R$ 800,00", img: "/img/rena.jpg", vendido: true },
  { titulo: "O Gato na Janela", dimensoes: "40 x 50 cm", tecnica: "Acrílica", preco: "R$ 1.100,00", img: "/img/gato-na-janela.jpg", vendido: true },
  { titulo: "Cores da Favela", dimensoes: "90 x 70 cm", tecnica: "Acrílica", preco: "R$ 2.000,00", img: "/img/favela.jpg", vendido: true },
  // ----------------------

  // --- OBRAS DISPONÍVEIS ---
  { titulo: "Cataratas do Iguaçu", dimensoes: "130 x 80 cm", tecnica: "Óleo sobre Tela", preco: "R$ 2.000,00", img: "/img/cataratas.jpg" },
  { titulo: "Araras Azuis", dimensoes: "90 x 70 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.800,00", img: "/img/araras.jpg" },
  { titulo: "Araucárias", dimensoes: "70 x 70 cm", tecnica: "Óleo sobre Tela", preco: "R$ 1.400,00", img: "/img/araucarias.jpg" },
  { titulo: "Fruto Proibido", dimensoes: "70 x 60 cm", tecnica: "Óleo sobre Tela", preco: "R$ 1.200,00", img: "/img/fruto.jpg" },
  { titulo: "Ruas de Paraty", dimensoes: "50 x 60 cm", tecnica: "Óleo sobre Tela", preco: "R$ 680,00", img: "/img/paraty.jpg" },
  { titulo: "Minas Gerais", dimensoes: "50 x 60 cm", tecnica: "Óleo sobre Tela", preco: "R$ 580,00", img: "/img/minas.jpg" },
  { titulo: "Paisagem de Minas II", dimensoes: "40 x 50 cm", tecnica: "Óleo sobre Tela", preco: "R$ 450,00", img: "/img/minas2.jpg" },
  
  { titulo: "Retrato da Mulher", dimensoes: "50 x 70 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.800,00", img: "/img/mulher.jpg" },
  { titulo: "Vaso de Rosas", dimensoes: "40 x 50 cm", tecnica: "Óleo sobre tela", preco: "R$ 950,00", img: "/img/rosas.jpg" },
  { titulo: "Varanda Azul", dimensoes: "60 x 80 cm", tecnica: "Acrílica", preco: "R$ 1.200,00", img: "/img/varanda.jpg" },
  { titulo: "Barco no Mar", dimensoes: "40 x 60 cm", tecnica: "Óleo sobre tela", preco: "R$ 900,00", img: "/img/barco.jpg" },
  { titulo: "Caminho de Santiago", dimensoes: "100 x 80 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.600,00", img: "/img/santiago.jpg" },
  { titulo: "Vista da Toscana", dimensoes: "70 x 50 cm", tecnica: "Óleo sobre tela", preco: "R$ 2.200,00", img: "/img/toscana.jpg" },
  { titulo: "Igreja em Minas III", dimensoes: "50 x 60 cm", tecnica: "Óleo sobre tela", preco: "R$ 580,00", img: "/img/minas3.jpg" },
  { titulo: "Campo de Lavandas Roxas", dimensoes: "80 x 60 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.300,00", img: "/img/landas-roxas.jpg" },
  { titulo: "Flor de Hibisco", dimensoes: "30 x 30 cm", tecnica: "Aquarela", preco: "R$ 700,00", img: "/img/hibisco.jpg" },
  { titulo: "Colheita de Lavanda", dimensoes: "70 x 50 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.300,00", img: "/img/lavandas.jpg" },
  { titulo: "Mar Revolto", dimensoes: "100 x 70 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.700,00", img: "/img/mar.jpg" },
  { titulo: "Caminho dos Eucaliptos", dimensoes: "60 x 40 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.400,00", img: "/img/eucalipto.jpg" },
  { titulo: "Ipê Amarelo", dimensoes: "80 x 60 cm", tecnica: "Óleo sobre tela", preco: "R$ 1.600,00", img: "/img/ipe.jpg" }
];
---

<BaseLayout
  titulo="Ana Morais — Galeria Oficial"
  descricao="Pinturas originais de Ana Morais."
>

  <script type="application/json" id="dados-obras">
    {JSON.stringify(obras)}
  </script>

  <script is:inline src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

  <header class="hero">
    <h1>Ana Morais</h1>
    <p>Galeria de Arte</p>
  </header>

  <main class="galeria">
    {obras.map((obra, index) => (
      <article class="card-obra">
        <div class="img-container js-abrir-zoom" data-index={index}>
          <img 
            src={obra.img} 
            alt={obra.titulo} 
            loading="lazy" 
            style="width: 100%; height: 100%; object-fit: cover;"
          />
          <span class="overlay-zoom">Ampliar</span>
        </div>

        <div class="info">
          <h3>{obra.titulo}</h3>
          <p class="tecnica">{obra.tecnica}</p>
          <p class="dimensoes">{obra.dimensoes}</p>
          <p class="preco">{obra.preco}</p>
          
          {obra.vendido ? (
            <button class="btn-zap vendido" disabled>
              Vendido
            </button>
          ) : (
            // Adicionei classe js-btn-zap para o JS encontrar
            <button class="btn-zap js-btn-zap" data-obra={obra.titulo}>
              Comprar Agora
            </button>
          )}

        </div>
      </article>
    ))}
  </main>

  <div id="modal" class="modal">
    <button class="nav prev" id="btn-prev">&#10094;</button>
    <button class="nav next" id="btn-next">&#10095;</button>
    <button class="fechar" id="btn-fechar">&times;</button>

    <div class="panzoom-container">
      <img id="modal-img" />
    </div>

    <div class="modal-footer">
      <span id="contador"></span>
    </div>
  </div>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      // 1. Recupera Dados
      const obrasData = JSON.parse(document.getElementById('dados-obras').textContent);
      
      // 2. Elementos Globais
      const modal = document.getElementById("modal");
      const img = document.getElementById("modal-img");
      const contador = document.getElementById("contador");
      let indexAtual = 0;
      let panzoom = null;
      
      // SEU NÚMERO CONFIGURADO AQUI:
      const WHATSAPP_NUMBER = "554598027599"; 

      // 3. Funções Lógicas
      function abrirModal(index) {
        indexAtual = index;
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("ativo"), 10);
        document.body.style.overflow = "hidden";
        atualizarImagem();
      }

      function fecharModal() {
        modal.classList.remove("ativo");
        setTimeout(() => {
          modal.style.display = "none";
          document.body.style.overflow = "auto";
          if (panzoom) panzoom.dispose();
        }, 300);
      }

      function navegar(dir) {
        indexAtual = (indexAtual + dir + obrasData.length) % obrasData.length;
        atualizarImagem();
      }

      function atualizarImagem() {
        img.src = obrasData[indexAtual].img;
        contador.textContent = `${obrasData[indexAtual].titulo} (${indexAtual + 1} / ${obrasData.length})`;

        if (panzoom) panzoom.dispose();

        img.onload = () => {
          // Verifica se a biblioteca Panzoom carregou
          if (typeof Panzoom !== 'undefined') {
            panzoom = Panzoom(img, { 
                maxScale: 4, 
                minScale: 0.5,
                contain: null,
                transformOrigin: "center center"
            });
            img.parentElement.addEventListener("wheel", panzoom.zoomWithWheel);
          }
        };
      }

      function comprarNoZap(nomeObra) {
        const msg = `Olá Ana! Quero comprar a obra "${nomeObra}". Qual a forma de pagamento?`;
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, "_blank");
      }

      // 4. LIGANDO OS EVENTOS (Onde a mágica acontece)
      
      // Botões de Zoom (Imagens)
      const imagens = document.querySelectorAll('.js-abrir-zoom');
      imagens.forEach(div => {
        div.addEventListener('click', () => {
          const idx = parseInt(div.getAttribute('data-index'));
          abrirModal(idx);
        });
      });

      // Botões de WhatsApp
      const botoesZap = document.querySelectorAll('.js-btn-zap');
      botoesZap.forEach(btn => {
        btn.addEventListener('click', () => {
          const nome = btn.getAttribute('data-obra');
          comprarNoZap(nome);
        });
      });

      // Controles do Modal
      document.getElementById('btn-fechar').addEventListener('click', fecharModal);
      document.getElementById('btn-prev').addEventListener('click', (e) => { e.stopPropagation(); navegar(-1); });
      document.getElementById('btn-next').addEventListener('click', (e) => { e.stopPropagation(); navegar(1); });

      // Teclado
      document.addEventListener("keydown", (e) => {
        if (modal.style.display === "flex") {
          if (e.key === "Escape") fecharModal();
          if (e.key === "ArrowRight") navegar(1);
          if (e.key === "ArrowLeft") navegar(-1);
        }
      });
    });
  </script>

  <style>
    /* ESTILOS GERAIS */
    * { box-sizing: border-box; }
    
    .hero { 
      text-align: center; 
      padding: 60px 20px; 
      background-color: white;
      border-bottom: 1px solid #eee;
    }
    .hero h1 { 
      font-family: 'Times New Roman', serif; 
      font-size: 3rem; 
      margin: 0 0 10px 0; 
      color: #333;
    }
    .hero p { 
      color: #777; font-style: italic; margin: 0; letter-spacing: 2px;
      text-transform: uppercase; font-size: 0.9rem;
    }

    /* GRADE */
    .galeria {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .card-obra {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.2s;
    }
    .card-obra:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

    /* IMAGEM */
    .img-container {
      height: 300px; width: 100%; position: relative; cursor: pointer; overflow: hidden; background: #f0f0f0;
    }
    .overlay-zoom {
      position: absolute; inset: 0; background: rgba(0,0,0,0.3); color: white;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; opacity: 0; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
    }
    .img-container:hover .overlay-zoom { opacity: 1; }
    .img-container:hover img { transform: scale(1.05); filter: brightness(0.9); }
    .img-container img { transition: 0.5s; }

    /* INFO */
    .info { padding: 20px; text-align: center; }
    .info h3 { margin: 0 0 5px 0; font-size: 1.2rem; color: #222; font-family: 'Times New Roman', serif;}
    .tecnica { color: #888; font-style: italic; font-size: 0.9rem; margin: 0 0 5px 0; }
    .dimensoes { font-size: 0.85rem; color: #666; margin-bottom: 10px; display: block;}
    .preco { font-size: 1.2rem; color: #D4AF37; font-weight: bold; margin-bottom: 15px; display: block;}

    /* BOTÕES */
    .btn-zap {
      background: #25D366; color: white; border: none; padding: 12px 20px; width: 100%;
      border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase;
      font-size: 0.9rem; transition: 0.2s;
    }
    .btn-zap:hover { background: #1ebc57; }

    .btn-zap.vendido {
      background: #ccc; 
      color: #666; 
      cursor: not-allowed;
    }
    .btn-zap.vendido:hover { background: #ccc; }

    /* MODAL */
    .modal {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      z-index: 9999; flex-direction: column; justify-content